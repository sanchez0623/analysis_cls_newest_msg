# CLS 财联社新闻监控与 AI 分析工具

基于 AI 分析的财联社热点实时监控工具，每隔 5 秒爬取最新一条信息，通过 GitHub Copilot API 进行市场情绪分析，评估新闻的市场影响力（1-10分）。

## 功能特点

- 🔄 **实时监控**: 每 5 秒自动获取财联社最新电报
- 🤖 **AI 分析**: 使用 GitHub Copilot SDK 进行智能分析
- 📊 **市场评分**: 1-10 分评估新闻市场热度（10分为最高）
- 🔍 **去重机制**: 自动跳过重复新闻
- 🛡️ **反爬对策**: 
  - API 签名生成
  - User-Agent 轮换
  - 请求重试机制
  - 连接池复用

## 项目结构

```
analysis_cls_newest_msg/
├── main.py              # 主程序入口
├── requirements.txt     # 依赖列表
├── .env.example        # 环境变量示例
├── src/
│   ├── __init__.py
│   ├── config.py       # 配置管理
│   ├── models.py       # 数据模型（含 StockRating, IndustryRating）
│   ├── scraper.py      # 爬虫模块
│   ├── analyzer.py     # 增强分析模块
│   └── ai_providers/   # AI 服务提供商
│       ├── __init__.py
│       ├── base.py     # 抽象基类
│       ├── factory.py  # 工厂函数
│       ├── copilot_provider.py  # GitHub Copilot
│       └── qiniu_provider.py    # 七牛云 (预留)
└── tests/
    ├── __init__.py
    ├── test_scraper.py
    └── test_analyzer.py
```

## 安装

1. 克隆仓库:
```bash
git clone https://github.com/sanchez0623/analysis_cls_newest_msg.git
cd analysis_cls_newest_msg
```

2. 创建虚拟环境并安装依赖:
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

3. 配置环境变量:
```bash
cp .env.example .env
# 编辑 .env 文件，填入您的 GitHub Token
```

## 使用方法

### 基本使用

```bash
python main.py
```

### 自定义配置

通过环境变量自定义配置:

```bash
# 设置爬取间隔为 10 秒
SCRAPE_INTERVAL=10 python main.py

# 设置日志级别为 DEBUG
LOG_LEVEL=DEBUG python main.py
```

### 配置选项

| 变量 | 默认值 | 说明 |
|------|--------|------|
| `GITHUB_TOKEN` | - | GitHub 令牌（用于 Copilot API） |
| `AI_PROVIDER` | copilot | AI 服务提供商 (copilot/qiniu) |
| `QINIU_ACCESS_KEY` | - | 七牛云 Access Key |
| `QINIU_SECRET_KEY` | - | 七牛云 Secret Key |
| `QINIU_API_ENDPOINT` | - | 七牛云 API 端点 |
| `SCRAPE_INTERVAL` | 5 | 爬取间隔（秒） |
| `FETCH_COUNT` | 1 | 每次获取的新闻数量 |
| `REQUEST_TIMEOUT` | 10 | 请求超时时间（秒） |
| `MAX_RETRIES` | 3 | 最大重试次数 |
| `LOG_LEVEL` | INFO | 日志级别 |

## 输出示例

```
============================================================
📰 新闻快讯 | 2024-01-15 10:30:45
============================================================
内容: 央行宣布降息25个基点，支持实体经济发展
相关股票: 工商银行, 建设银行
相关主题: 货币政策, 央行
============================================================
📊 市场热度: ★★★★★★★★☆☆ (8/10)
📈 市场影响: 利好
💡 分析: 央行降息释放明确宽松信号，利好银行股和资本市场
🎯 市场影响: 可能推动银行板块和大盘整体上涨
------------------------------------------------------------
📌 个股影响评级:
   • 工商银行: 利好 ★★★★★★★★☆☆ (8/10)
     原因: 降息降低资金成本，利好银行净息差
   • 建设银行: 利好 ★★★★★★★☆☆☆ (7/10)
     原因: 宽松政策提振信贷需求
------------------------------------------------------------
🏭 行业影响评级 (第一性原理分析):
   • 银行: 利好 ★★★★★★★★☆☆ (8/10)
     龙头股票: 工商银行, 建设银行, 招商银行
     分析: 基于第一性原理，银行业核心价值在于息差收入和资产质量
============================================================
```

## 评分机制

### 个股评级
当新闻涉及具体个股时，系统会针对每只股票进行独立评估：
- **影响方向**：利好 / 利空
- **评分**：1-10分（10分为极大影响）
- **原因**：简短说明评级依据

### 行业评级（第一性原理）
当新闻为行业事件时，系统会运用马斯克的"第一性原理"进行分析：
1. 识别事件涉及的核心行业
2. 从行业基本面出发分析本质影响
3. 找出行业龙头企业（最受益/最受影响的领头羊）
4. 给出行业整体评级

### 评分标准

| 分数 | 含义 | 示例 |
|------|------|------|
| 9-10 | 重大市场影响 | 央行重大政策、行业突破性进展 |
| 7-8 | 较大市场影响 | 重要经济数据、大型企业重大事件 |
| 5-6 | 一般市场影响 | 普通行业新闻、常规公司公告 |
| 3-4 | 较小市场影响 | 小型公司新闻、地方性事件 |
| 1-2 | 无实质影响 | 无关市场的一般信息 |

## 运行测试

```bash
python -m pytest tests/ -v
```

## 架构设计

### 爬虫模块 (scraper.py)

- **签名生成**: 使用 SHA1 + MD5 双重加密生成 API 签名
- **重试机制**: 使用 tenacity 库实现指数退避重试
- **User-Agent 轮换**: 随机选择 User-Agent 避免被封禁
- **会话管理**: 使用 requests.Session 实现连接池复用

### 分析模块 (analyzer.py)

- **多模式分析**: 
  - 支持多种 AI 服务提供商（GitHub Copilot、七牛云等）
  - 备用关键词分析引擎确保服务可用性
- **增强评分机制**:
  - 个股影响评级：针对具体股票的好坏评估 + 1-10分评分
  - 行业评级：基于第一性原理分析行业影响及龙头股票
- **响应解析**: 智能解析 AI 返回的结构化数据

### AI 服务提供商 (ai_providers/)

- **抽象接口**: AIProvider 基类定义统一接口
- **GitHub Copilot**: 使用 GitHub Copilot SDK 进行分析
- **七牛云**: 支持七牛云 AI API（预留接口）
- **工厂模式**: 通过配置动态创建服务提供商

### 配置管理 (config.py)

- 使用 dataclass 管理配置
- 支持环境变量覆盖
- 支持多种 AI 服务提供商配置
- 集中化配置管理

## 依赖项

- `requests`: HTTP 客户端
- `python-dotenv`: 环境变量管理
- `tenacity`: 重试机制

## 注意事项

1. 请遵守财联社的使用条款，合理使用爬虫
2. 建议设置合理的爬取间隔，避免对服务器造成压力
3. 本工具仅供学习和研究使用，请勿用于商业用途
4. AI 分析结果仅供参考，不构成投资建议

## License

MIT License